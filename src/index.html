<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>Is het tijd voor het karretje? ðŸš— | Vrijdagmelding</title>
    <meta name="description" content="Check of het al tijd is voor het karretje! Elke vrijdag na 16:00 is het tijd om te gaan shoppen, feesten of wat jouw definitie van 'het karretje' ook is. ðŸ›’ðŸ»">
    <meta name="keywords" content="vrijdag, karretje, shoppen, feesten, weekend, vrijdagmiddag, 16:00, tijd voor het karretje">
    <meta name="author" content="Karretje Team">
    <meta name="robots" content="index, follow">
    <meta name="language" content="Dutch">
    <meta name="revisit-after" content="7 days">
    
    <!-- Open Graph / Facebook / WhatsApp -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.ishettijdvoorhetkarretje.nl/">
    <meta property="og:title" content="Is het tijd voor het karretje? ðŸš—">
    <meta property="og:description" content="Check of het al tijd is voor het karretje! Elke vrijdag na 16:00 is het tijd om te gaan shoppen, feesten of wat jouw definitie van 'het karretje' ook is. ðŸ›’ðŸ»">
    <meta property="og:image" content="https://www.ishettijdvoorhetkarretje.nl/assets/full_cart.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="Het is tijd voor het karretje!">
    <meta property="og:site_name" content="Is het tijd voor het karretje?">
    <meta property="og:locale" content="nl_NL">
    
    <!-- Twitter Card -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://www.ishettijdvoorhetkarretje.nl/">
    <meta property="twitter:title" content="Is het tijd voor het karretje? ðŸš—">
    <meta property="twitter:description" content="Check of het al tijd is voor het karretje! Elke vrijdag na 16:00 is het tijd om te gaan shoppen, feesten of wat jouw definitie van 'het karretje' ook is. ðŸ›’ðŸ»">
    <meta property="twitter:image" content="https://www.ishettijdvoorhetkarretje.nl/assets/full_cart.jpg">
    <meta property="twitter:image:alt" content="Het is tijd voor het karretje!">
    
    <!-- Additional SEO -->
    <meta name="theme-color" content="#000000">
    <meta name="msapplication-TileColor" content="#000000">
    <meta name="msapplication-TileImage" content="assets/android-chrome-192x192.png">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://www.ishettijdvoorhetkarretje.nl/">
    
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png">
    <link rel="icon" href="assets/favicon.ico">
    <link rel="manifest" href="assets/site.webmanifest">
    
    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Is het tijd voor het karretje?",
        "description": "Check of het al tijd is voor het karretje! Elke vrijdag na 16:00 is het tijd om te gaan shoppen, feesten of wat jouw definitie van 'het karretje' ook is.",
        "url": "https://www.ishettijdvoorhetkarretje.nl/",
        "applicationCategory": "EntertainmentApplication",
        "operatingSystem": "Web Browser",
        "author": {
            "@type": "Organization",
            "name": "Karretje Team"
        },
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "EUR"
        },
        "image": "https://www.ishettijdvoorhetkarretje.nl/assets/full_cart.jpg",
        "screenshot": "https://www.ishettijdvoorhetkarretje.nl/assets/full_cart.jpg",
        "featureList": [
            "Vrijdagmelding",
            "Real-time countdown",
            "Interactive effects",
            "Mobile responsive"
        ]
    }
    </script>
    <script>
        function init() {
            // Get themed video from festivity manager
            const videoSrc = window.festivityManager ? window.festivityManager.getVideo('init') : 'assets/default-mode/fish.mp4';

            // Check if we're in a special festive mode that should show init video
            const currentTheme = window.festivityManager ? window.festivityManager.getCurrentTheme().name : 'Default';
            const shouldShowInitVideo = currentTheme === 'Halloween'; // Only show for Halloween

            if (shouldShowInitVideo) {
                // In special festive mode: show video in bottom right corner with sound
                const html = `
                    <video loop id="main-init-video">
                        <source src="${videoSrc}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>`

                const div = document.createElement('div');
                div.innerHTML = html;
                document.body.appendChild(div);

                const video = div.querySelector('video');
                video.muted = false;
                video.autoplay = true;
                video.style.position = 'fixed';
                video.style.bottom = '0px';
                video.style.right = '0px';
                video.style.zIndex = '1000';
                video.style.width = document.body.clientWidth * 0.2 + 'px';
                video.style.height = document.body.clientHeight * 0.2 + 'px';
                video.play();
            } else {
                // In default/Christmas mode: keep original hidden behavior
                const html = `
                    <video loop>
                        <source src="${videoSrc}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>`

                const div = document.createElement('div');
                div.style.display = 'none';
                div.innerHTML = html;
                document.body.appendChild(div);

                const video = div.querySelector('video');
                video.muted = false;
                video.autoplay = true;
                video.play();
            }

            const button = document.querySelector('.annoying-button');

            // Remove button element
            button.remove();

            // Add new gif fixed to the bottom left corner (using themed version)
            const catGifSrc = window.festivityManager ? window.festivityManager.getGif('cat') : 'assets/default-mode/cat.gif';
            console.log('Init button clicked - cat gif src:', catGifSrc);
            console.log('Current theme:', window.festivityManager ? window.festivityManager.getCurrentTheme().name : 'No festivity manager');
            const gif = document.createElement('img');
            gif.src = catGifSrc;
            gif.id = 'cat-gif'; // Add ID for easier selection

            gif.style.position = 'fixed';
            gif.style.bottom = `0px`;
            gif.style.left = '0px';
            gif.style.width = document.body.clientWidth * 0.2 + 'px';
            gif.style.height = document.body.clientHeight * 0.2 + 'px';
            gif.style.zIndex = '1000';
            document.body.appendChild(gif);

            // Update festivity manager cache now that cat exists
            if (window.festivityManager) {
                window.festivityManager.cachedElements = null;

                // Trigger background audio playback (user interaction allows it)
                if (window.festivityManager.backgroundAudio) {
                    console.log('Attempting to play background audio after init button click');
                    window.festivityManager.backgroundAudio.play().catch(e => {
                        console.error('Failed to play background audio:', e);
                    });
                }
            }

        }

        // Optimized mousemove with RAF batching and element caching
        let annoyingButton = null;
        let mousePos = { x: 0, y: 0 };
        let rafPending = false;

        // Wait for DOM to load before selecting button
        document.addEventListener('DOMContentLoaded', () => {
            annoyingButton = document.querySelector('.annoying-button');
        });

        addEventListener('mousemove', (e) => {
            mousePos.x = e.clientX;
            mousePos.y = e.clientY;

            if (!rafPending && annoyingButton) {
                rafPending = true;
                requestAnimationFrame(() => {
                    // Check if button still exists before trying to move it
                    if (!annoyingButton || !document.body.contains(annoyingButton)) {
                        rafPending = false;
                        return;
                    }

                    const top = mousePos.y - annoyingButton.clientHeight / 2;
                    const left = mousePos.x - annoyingButton.clientWidth / 2;

                    annoyingButton.style.top = `${top}px`;
                    annoyingButton.style.left = `${left}px`;
                    rafPending = false;
                });
            }
        })


        // Toggle festive theme function
        function toggleFestiveTheme() {
            if (window.festivityManager) {
                const newTheme = window.festivityManager.toggleTheme();

                // Update button visibility based on current theme
                updateToggleButtonVisibility();

                // Trigger background audio playback after toggle (user interaction allows it)
                if (window.festivityManager.backgroundAudio) {
                    console.log('Attempting to play background audio after theme toggle');
                    window.festivityManager.backgroundAudio.play().catch(e => {
                        console.error('Failed to play background audio:', e);
                    });
                }
            } else {
                console.error('Festivity manager not available');
            }
        }
        
        // Update toggle button visibility
        function updateToggleButtonVisibility() {
            const themeTesting = document.getElementById('theme-testing');
            if (themeTesting && window.festivityManager) {
                const currentTheme = window.festivityManager.getCurrentTheme();
                // Show button if we're in a special month OR if we're currently in a festive theme
                if (window.festivityManager.isSpecialMonth() || currentTheme.name !== 'Default') {
                    themeTesting.style.display = 'block';
                } else {
                    themeTesting.style.display = 'none';
                }
            }
        }

        // Show toggle festive button only when festive mode is available
        document.addEventListener('DOMContentLoaded', () => {
            const themeTesting = document.getElementById('theme-testing');
            if (themeTesting && window.festivityManager) {
                // Only show if we're in a special month (festive mode available)
                if (window.festivityManager.isSpecialMonth()) {
                    themeTesting.style.display = 'block';
                } else {
                    themeTesting.style.display = 'none';
                }
            }
        });

    </script>
    <style>
        .annoying-button {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
            background-color: greenyellow;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
        }
    </style>

    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <button class="annoying-button" style="font-size: 2em" onclick="init()">Klik hier voor de volledige ervaring</button>
    
    <!-- Toggle Festive Mode Button -->
    <div id="theme-testing" style="position: fixed; top: 20px; right: 20px; z-index: 10000; display: none;">
        <button id="toggle-festive-btn" onclick="toggleFestiveTheme()" class="toggle-festive-btn">
            ðŸŽ‰ Toggle Festive Mode
        </button>
    </div>
    <div class="side">
        <video autoplay loop muted playsinline preload="metadata" class="lazy-video">
            <source src="assets/default-mode/youtube_RbVMiu4ubT0_480x854_h264.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
    </div>

    <div class="center">
        <div class="fish">
            <video autoplay loop muted playsinline preload="metadata" class="lazy-video">
                <source src="assets/default-mode/fish.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>
        </div>
        
        <div class="content" id="content">
            <img class="icon" id="icon" src="assets/default-mode/empty_cart.png" alt="Cart Icon">
            <div id="message" class="message"></div>
            <p id="remaining-time"></p>
            <img id="beer-drinking-gif" src="assets/default-mode/beer-drinking.gif" alt="Beer drinking animation" style="position: relative; display: block; margin: 0 auto;">

            <!-- Game link - only visible when NOT party time -->
            <div id="waiting-content" style="display: none;">
                <p>Speel Karretje the game!!!!! terwijl je wacht tot het vrijdag 16:00 is!</p>
                <a href="./karretje-the-game.html" class="game-link">
                    <img src="assets/kar.png" alt="Karretje" class="">
                </a>
            </div>
        </div>
        
        <div class="fish">
            <video autoplay loop muted playsinline preload="metadata" class="lazy-video">
                <source src="assets/default-mode/fish.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>
        </div>
    </div>

    <div class="side">
        <video autoplay loop muted playsinline preload="metadata" class="lazy-video">
            <source src="assets/default-mode/youtube_RbVMiu4ubT0_480x854_h264.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
    </div>

    <script src="js/timeManager.js?v=2"></script>
    <script src="js/festivityManager.js?v=18"></script>
    <script src="js/coinCursor.js?v=2"></script>
    <script src="js/main.js?v=2"></script>
</body>
</html>
